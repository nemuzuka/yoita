//設備メンテナンスのjs
function initDialog(){$("#facilitiesDialog").dialog({modal:!0,autoOpen:!1,width:600,resizable:!1,open:function(e){openModalDialog()},close:function(e){closeModelDialog()},show:"clip",hide:"clip"}),$("#facilitiesSortDialog").dialog({modal:!0,autoOpen:!1,width:600,resizable:!1,open:function(e){openModalDialog()},close:function(e){closeModelDialog()},show:"clip",hide:"clip"}),$("#facilitiesDialog-add").click(function(){execute()}),$("#facilitiesDialog-cancel").click(function(){$("#facilitiesDialog").dialog("close")}),$("#sortFacilitiesBtn").click(function(){openSortDialog()}),$("#sort_up").click(function(){upItems("facilities_to")}),$("#sort_down").click(function(){downItems("facilities_to")}),$("#facilitiesSortDialog-execute").click(function(){executeSort()}),$("#facilitiesSortDialog-cancel").click(function(){$("#facilitiesSortDialog").dialog("close")})}function searchFacilities(){var e={};e.name=$("#search_name").val(),setAjaxDefault(),$.ajax({type:"GET",url:"/ajax/facilities/list",data:e}).then(function(e){render(e)})}function reSearchAndRender(){setAjaxDefault(),$.ajax({type:"GET",url:"/ajax/facilities/refresh"}).then(function(e){render(e)})}function turnFacilities(e,t){setAjaxDefault();var n={};n.page_no=e,$.ajax({type:"GET",url:t,data:n}).then(function(e){render(e)})}function render(e){$("#result_area").empty();var t=e.result;infoCheck(e);if(errorCheck(e)==0||t.total_count==0)return;var n=$("<div />").addClass("widget"),r=$("<div />").addClass("widget-header").append($("<h2 />").addClass("title").text("検索結果")),i=$("<div />").addClass("widget-content"),s=$("<div />").addClass("pager-area").append($("<span />").addClass("count").text("全"+t.total_count+"件")).append(t.link),o=$("<table />").attr({id:"result_list"}).addClass("result_table"),u=$("<tbody />"),a=$("<thead />").append($("<tr />").append($("<th />").text("設備名").attr({width:"35%"})).append($("<th />").text("メモ")).append($("<th />").text("").attr({width:"50px"})));o.append(a),$.each(t.list,function(){var e=$("<input />").attr({type:"button",value:"削除"}).addClass("btn btn-danger btn-mini"),t=this.id,n=this.lock_version,r=this.name,i=escapeTextArea(this.memo),s=$("<a />").attr({href:"javascript:void(0)"}).text(r);s.click(function(){openEditDialog(t)}),e.click(function(){deleteFacilities(t,n,r)});var o=$("<tr />");o.append($("<td />").append(s)).append($("<td />").html(i)).append($("<td />").append(e)),u.append(o)}),o.append(u),i.append(s).append(o),n.append(r).append(i),$("#result_area").append(n).addClass("onload")}function openEditDialog(e){var t="",n="";e==""?(t="設備登録",n="登録する"):(t="設備変更",n="変更する"),$("#ui-dialog-title-facilitiesDialog").empty(),$("#ui-dialog-title-facilitiesDialog").append(t),$("#facilitiesDialog-add").attr({value:n});var r={};r.resource_id=e,setAjaxDefault();var i;i=$.ajax({type:"GET",url:"/ajax/facilities/show",data:r}),i.pipe(function(e){if(errorCheck(e)==0){if(e.status_code==-6)return reSearchAndRender();return}var t=e.result;$("#resource_name").val(t.name),$("#resource_memo").val(t.memo),$("#resource_lock_version").val(t.lock_version),$("#resource_id").val(t.id),prependDummyText("facilitiesDialog"),$("#facilitiesDialog").dialog("open"),removeDummyText("facilitiesDialog");return})}function execute(){var e=createExecuteParams();if(validate(e)==0)return;setAjaxDefault();var t;t=$.ajax({type:"POST",url:"/ajax/facilities/save",data:e}),t.pipe(function(e){if(errorCheck(e)==0&&e.status_code==-1)return;return infoCheck(e),$("#facilitiesDialog").dialog("close"),reSearchAndRender()})}function createExecuteParams(){var e={};e.resource={};var t=e.resource;return t.name=$("#resource_name").val(),t.memo=$("#resource_memo").val(),t.id=$("#resource_id").val(),t.lock_version=$("#resource_lock_version").val(),setToken(e),e}function validate(e){var t=new Validate,n=e.resource;return t.addRules({value:n.name,option:"required",error_args:"設備名"}),t.addRules({value:n.name,option:"maxLength",error_args:"設備名",size:128}),t.addRules({value:n.memo,option:"maxLength",error_args:"メモ",size:1024}),t.execute()}function deleteFacilities(e,t,n){if(window.confirm("設備「"+n+"」を削除します。本当によろしいですか？")==0)return;var r={};r.resource_id=e,r.lock_version=t,setToken(r),setAjaxDefault();var i;i=$.ajax({type:"POST",url:"/ajax/facilities/destroy",data:r}),i.pipe(function(e){return errorCheck(e),infoCheck(e),reSearchAndRender()})}function openSortDialog(){return setAjaxDefault(),$.ajax({type:"GET",url:"/ajax/facilities/get_sort_info"}).then(function(e){renderSortDialog(e)})}function renderSortDialog(e){$("#facilities_to").empty();if(errorCheck(e)==0)return;infoCheck(e);var t=e.result;if(t.length==0)return;$.each(t,function(){var e=this.id,t=this.name;$("#facilities_to").append($("<option />").attr({value:e}).text(t))}),reWriteSelect("facilities_to",new Array),prependDummyText("facilitiesSortDialog"),$("#facilitiesSortDialog").dialog("open"),removeDummyText("facilitiesSortDialog")}function executeSort(){var e={};e.ids=getSelectArray("facilities_to"),setToken(e),setAjaxDefault();var t;t=$.ajax({type:"POST",url:"/ajax/facilities/update_sort_order",data:e}),t.pipe(function(e){if(errorCheck(e)==0&&e.status_code==-1)return;return infoCheck(e),$("#facilitiesSortDialog").dialog("close"),reSearchAndRender()})}$(function(){$(window).unload(function(){unBlockLoadingMsg()}),initDialog(),$("#addFacilitiesBtn").click(function(){openEditDialog("")}),setAjaxDefault(),$.ajax({type:"GET",url:"/ajax/facilities/get_serch_info"}).then(function(e){if(errorCheck(e)==0)return;var t=e.result;$("#search_name").val(t.name),t.click_search==1&&reSearchAndRender()}),$("#searchFacilitiesBtn").click(function(){searchFacilities()})});