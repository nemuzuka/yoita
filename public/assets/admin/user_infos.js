//ユーザメンテナンスのjs
function initDialog(){$("#userInfosDialog").dialog({modal:!0,autoOpen:!1,width:700,resizable:!1,open:function(e){openModalDialog()},close:function(e){closeModelDialog()},show:"clip",hide:"clip"}),$("#userInfosSortDialog").dialog({modal:!0,autoOpen:!1,width:600,resizable:!1,open:function(e){openModalDialog()},close:function(e){closeModelDialog()},show:"clip",hide:"clip"}),$.datepicker.setDefaults($.extend($.datepicker.regional.ja)),$("#validity_start_date").datepicker(),$("#validity_end_date").datepicker(),$("#userInfosDialog-add").click(function(){execute()}),$("#userInfosDialog-cancel").click(function(){$("#userInfosDialog").dialog("close")}),$("#sortUserInfosBtn").click(function(){openSortDialog()}),$("#sort_up").click(function(){upItems("userInfos_to")}),$("#sort_down").click(function(){downItems("userInfos_to")}),$("#userInfosSortDialog-execute").click(function(){executeSort()}),$("#userInfosSortDialog-cancel").click(function(){$("#userInfosSortDialog").dialog("close")})}function searchUserInfos(){var e={};e.name=$("#search_name").val(),e.reading_character=$("#search_reading_character").val(),$("#search_admin_only").attr("checked")==undefined?e.admin_only="0":e.admin_only="1",e.search_type=$("input[type='radio'][name='searchType']:checked").val(),setAjaxDefault(),$.ajax({type:"GET",url:"/ajax/userInfos/list",data:e}).then(function(e){render(e)})}function reSearchAndRender(){setAjaxDefault(),$.ajax({type:"GET",url:"/ajax/userInfos/refresh"}).then(function(e){render(e)})}function turnUserInfos(e,t){setAjaxDefault();var n={};n.page_no=e,$.ajax({type:"GET",url:t,data:n}).then(function(e){render(e)})}function render(e){$("#result_area").empty();var t=e.result;infoCheck(e);if(errorCheck(e)==0||t.total_count==0)return;var n=$("<div />").addClass("widget"),r=$("<div />").addClass("widget-header").append($("<h2 />").addClass("title").text("検索結果")),i=$("<div />").addClass("widget-content"),s=$("<div />").addClass("pager-area").append($("<span />").addClass("count").text("全"+t.total_count+"件")).append(t.link),o=$("<table />").attr({id:"result_list"}).addClass("result_table"),u=$("<tbody />"),a=$("<thead />").append($("<tr />").append($("<th />").text("ログインID")).append($("<th />").text("ユーザ名").attr({width:"35%"})).append($("<th />").text("ふりがな")).append($("<th />").text("管理者").attr({width:"50px"})).append($("<th />").text("メモ")).append($("<th />").text("").attr({width:"50px"})));o.append(a),$.each(t.list,function(){var e=this.record,t=$("<input />").attr({type:"button",value:"削除"}).addClass("btn btn-danger btn-mini"),n=e.resource_id,r=e.name,i=escapeTextArea(e.memo),s=e.resource_lock_version,o=e.reading_character,a="◯";e.admin_flg=="0"&&(a="");var f=e.user_info_lock_version,l=e.login_lock_version,c=e.login_id,h="";this.disable==1&&(h="disableColor");var p=$("<a />").attr({href:"javascript:void(0)"}).text(c);p.click(function(){openEditDialog(n)}),t.click(function(){deleteUserInfos(n,s,f,l,r)});var d=$("<tr />");d.append($("<td />").append(p)).append($("<td />").text(r)).append($("<td />").text(o)).append($("<td />").text(a).attr({align:"center"})).append($("<td />").html(i)).append($("<td />").append(t)),h!=""&&d.addClass(h),u.append(d)}),o.append(u),i.append(s).append(o),n.append(r).append(i),$("#result_area").append(n).addClass("onload")}function openEditDialog(e){var t="",n="";e==""?(t="ユーザ登録",n="登録する"):(t="ユーザ変更",n="変更する"),$("#ui-dialog-title-userInfosDialog").empty(),$("#ui-dialog-title-userInfosDialog").append(t),$("#userInfosDialog-add").attr({value:n});var r={};r.resource_id=e,setAjaxDefault();var i;i=$.ajax({type:"GET",url:"/ajax/userInfos/show",data:r}),i.pipe(function(e){if(errorCheck(e)==0){if(e.status_code==-6)return reSearchAndRender();return}var t=e.result.detail,n=t.resource;$("#resource_name").val(n.name),$("#resource_memo").val(n.memo),$("#resource_lock_version").val(n.lock_version),$("#resource_id").val(n.id);var r=t.user_info;$("#reading_character").val(r.reading_character),$("#tel").val(r.tel),$("#mail").val(r.mail);var i=e.result.user_group_list;$("#default_user_group").empty(),i!=null&&$.each(i,function(){$("#default_user_group").append($("<option />").attr({value:this.key}).text(this.value))}),$("#default_user_group").val(r.default_user_group),$("#per_page").val(r.per_page),$("#validity_start_date").val(formatDateyyyyMMdd(r.validity_start_date)),$("#validity_end_date").val(formatDateyyyyMMdd(r.validity_end_date)),r.admin_flg!=null&&r.admin_flg=="1"?$("#admin_flg").prop("checked",!0):$("#admin_flg").prop("checked",!1),$("#user_info_lock_version").val(r.lock_version),login=t.login,$("#login_id").val(""),$("#password").val(""),$("#confirm_password").val(""),$("#update_password").val(""),$("#view_login_id").text(""),$("#confirm_password").removeClass("required-input"),n.id==null||n.id==""?($(".ins_area").show(),$(".upd_area").hide(),$("#confirm_password").addClass("required-input")):($(".ins_area").hide(),$(".upd_area").show(),$("#view_login_id").text(login.login_id)),$("#login_lock_version").val(login.lock_version),prependDummyText("userInfosDialog"),$("#userInfosDialog").dialog("open"),removeDummyText("userInfosDialog");return})}function execute(){var e=createExecuteParams();if(validate(e)==0)return;setAjaxDefault();var t;t=$.ajax({type:"POST",url:"/ajax/userInfos/save",data:e}),t.pipe(function(e){if(errorCheck(e)==0)if(e.status_code==-1||e.status_code==-5)return;return infoCheck(e),$("#userInfosDialog").dialog("close"),reSearchAndRender()})}function createExecuteParams(){var e={};e.resource={};var t=e.resource;t.name=$("#resource_name").val(),t.memo=$("#resource_memo").val(),t.id=$("#resource_id").val(),t.lock_version=$("#resource_lock_version").val(),e.user_info={};var n=e.user_info;n.reading_character=$("#reading_character").val(),n.tel=$("#tel").val(),n.mail=$("#mail").val(),n.default_user_group=$("#default_user_group").val(),n.per_page=$("#per_page").val(),n.validity_start_date=$("#validity_start_date").val(),n.validity_end_date=$("#validity_end_date").val(),$("#admin_flg").attr("checked")==undefined?n.admin_flg="0":n.admin_flg="1",n.lock_version=$("#user_info_lock_version").val(),e.login={};var r=e.login;return r.login_id=$("#login_id").val(),t["id"]==null||t["id"]==""?r.password=$("#password").val():r.password=$("#update_password").val(),r.confirm_password=$("#confirm_password").val(),setToken(e),e}function validate(e){var t=new Validate,n=e.resource;t.addRules({value:n.name,option:"required",error_args:"ユーザ名"}),t.addRules({value:n.name,option:"maxLength",error_args:"ユーザ名",size:128});var r=e.user_info;t.addRules({value:n.reading_character,option:"maxLength",error_args:"ふりがな",size:128});var i=e.login;return n["id"]==null||n["id"]==""?(t.addRules({value:i.login_id,option:"required",error_args:"ログインID"}),t.addRules({value:i.login_id,option:"maxLength",error_args:"ログインID",size:256}),t.addRules({value:i.password,option:"required",error_args:"パスワード"}),t.addRules({value:i.password,option:"minLength",error_args:"パスワード",size:6}),t.addRules({value1:i.password,value2:i.confirm_password,option:"eachValue",error_args:"パスワード",error_args2:"確認用パスワード"})):i["password"]!=null&&i["password"]!=""&&(t.addRules({value:i.password,option:"minLength",error_args:"パスワード",size:6}),t.addRules({value:i.password,value:i.confirm_password,option:"eachValue",error_args:"パスワード",error_args2:"パスワード(確認用)"})),t.addRules({value:r.tel,option:"maxLength",error_args:"TEL",size:48}),t.addRules({value:r.mail,option:"maxLength",error_args:"メールアドレス",size:256}),t.addRules({value:r.validity_start_date,option:"required",error_args:"有効開始日"}),t.addRules({value:r.validity_start_date,option:"date",error_args:"有効開始日"}),t.addRules({value:r.validity_end_date,option:"date",error_args:"有効終了日"}),r["validity_end_date"]!=null&&r["validity_end_date"]!=""&&t.addRules({fromValue:r.validity_start_date,toValue:r.validity_end_date,option:"dateRange",error_args:"有効開始日",error_args2:"有効終了日",error_args3:"日付"}),t.addRules({value:n.memo,option:"maxLength",error_args:"メモ",size:1024}),t.execute()}function deleteUserInfos(e,t,n,r,i){if(window.confirm("ユーザ「"+i+"」を削除します。本当によろしいですか？")==0)return;var s={};s.resource={};var o=s.resource;o.id=e,o.lock_version=t,s.user_info={};var u=s.user_info;u.lock_version=n,s.login={};var a=s.login;a.lock_version=r,setToken(s),setAjaxDefault();var f;f=$.ajax({type:"POST",url:"/ajax/userInfos/destroy",data:s}),f.pipe(function(e){return errorCheck(e),infoCheck(e),reSearchAndRender()})}function openSortDialog(){return setAjaxDefault(),$.ajax({type:"GET",url:"/ajax/userInfos/get_sort_info"}).then(function(e){renderSortDialog(e)})}function renderSortDialog(e){$("#userInfos_to").empty();if(errorCheck(e)==0)return;infoCheck(e);var t=e.result;if(t.length==0)return;$.each(t,function(){var e=this.id,t=this.name;$("#userInfos_to").append($("<option />").attr({value:e}).text(t))}),reWriteSelect("userInfos_to",new Array),prependDummyText("userInfosSortDialog"),$("#userInfosSortDialog").dialog("open"),removeDummyText("userInfosSortDialog")}function executeSort(){var e={};e.ids=getSelectArray("userInfos_to"),setToken(e),setAjaxDefault();var t;t=$.ajax({type:"POST",url:"/ajax/userInfos/update_sort_order",data:e}),t.pipe(function(e){if(errorCheck(e)==0&&e.status_code==-1)return;return infoCheck(e),$("#userInfosSortDialog").dialog("close"),reSearchAndRender()})}$(function(){$(window).unload(function(){unBlockLoadingMsg()}),initDialog(),$("#addUserInfosBtn").click(function(){openEditDialog("")}),setAjaxDefault(),$.ajax({type:"GET",url:"/ajax/userInfos/get_serch_info"}).then(function(e){if(errorCheck(e)==0)return;var t=e.result;$("#search_name").val(t.name),$("#search_reading_character").val(t.reading_character),t.admin_only!=null&&t.admin_only==1?$("#search_admin_only").prop("checked",!0):$("#search_admin_only").prop("checked",!1),$("input[type='radio'][name='searchType']").val([t.search_type]),t.click_search==1&&reSearchAndRender()}),$("#searchUserInfosBtn").click(function(){searchUserInfos()})});